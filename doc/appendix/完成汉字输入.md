## B.3 完成汉字输入

加载2023年10月20日版本的track.xml断点文件，调试时会包含如下跟踪信息。该信息包含了从按下空格键选择候选字词到将汉字输出到文档中的主要函数调用过程。

候选窗口开启时，当按下数字键或使用鼠标选择候选字词时，输入法会计算当前候选项的索引，将当前候选字词输出到文档中。本文只跟踪了其中最简单的场景：按下空格键选择候选字词。

按下空格键后，输入法判断是否处理该按键。如果需要处理该按键，则发起编辑会话。

Function																													|Description
-|-
CSampleIME::_TerminateComposition(unsigned long, ITfContext *, int)
CSampleIME::_ClearCompositionDisplayAttributes(unsigned long, ITfContext *)
CSampleIME::OnEndEdit(ITfContext *, unsigned long, ITfEditRecord *)
 CSampleIME::_IsComposing(void) 0x0000000000000000 <NULL>
*/
CSampleIME::OnKeyDown(ITfContext *, unsigned __int64, __int64, int *) end
/*
CSampleIME::OnKeyUp(ITfContext *, unsigned __int64, __int64, int *)
 Global::UpdateModifiers(unsigned __int64, __int64)
 CSampleIME::_IsKeyEaten(ITfContext *, unsigned int, unsigned int *, wchar_t *, _KEYSTROKE_STATE *)
 CSampleIME::_IsKeyboardDisabled(void)
 CSampleIME::ConvertVKey(unsigned int)
 VKeyFromVKPacketAndWchar(unsigned int, wchar_t)
 CSampleIME::_IsComposing(void) 0x0000000000000000 <NULL>
 CCompositionProcessorEngine::IsVirtualKeyNeed(unsigned int, wchar_t *, int, CANDIDATE_MODE, int, _KEYSTROKE_STATE *)
 CCompositionProcessorEngine::IsVirtualKeyKeystrokeComposition(unsigned int, _KEYSTROKE_STATE *, KEYSTROKE_FUNCTION)
 CCompositionProcessorEngine::IsVirtualKeyKeystrokeComposition(unsigned int, _KEYSTROKE_STATE *, KEYSTROKE_FUNCTION)
 CCompositionProcessorEngine::IsKeystrokeRange(unsigned int, _KEYSTROKE_STATE *, CANDIDATE_MODE)
 CCompositionProcessorEngine::IsVirtualKeyKeystrokeComposition(unsigned int, _KEYSTROKE_STATE *, KEYSTROKE_FUNCTION)
 CCompositionProcessorEngine::IsPunctuation(wchar_t)
CSampleIME::OnKeyUp(ITfContext *, unsigned __int64, __int64, int *) end
*/