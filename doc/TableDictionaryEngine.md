## 3.23 词典引擎

词典引擎，获取候选列表。

我最初一直以为输入法发明人追求低重码率是因为当时硬件条件的限制，现在才意识到，很可能从二十世纪中文打字机的时代，发明人就开始试图将汉字和键盘操作一一映射起来。<br>
这一点也体现在输入法的专利分类上，由于不能将词典的检索方式申请为专利，所以输入法的专利都申请为了汉字的一种键盘输入方式。

这就将输入法具体成为了汉字的编码，然后具体到了键盘键位。发明人想尽了一切办法，把汉字用某种规则排列到键盘上。作者也是其中一员，作者还在以电脑输入法的开发思路，研究手机输入法。
直到使用了触屏手机很久很久，才知道哪里出了问题。

这可能是个语言学课题，那就是拼音文字是否是因为借用他国文字注音，不断抽象化的过程。<br>
假设太平洋上还有很多国家，这些国家借用日韩的文字，来给自己的语言注音。其中一个国家后来影响力巨大，是否这个国家的文字会变成太平洋中的“拉丁字母”。

再假设人类是三头六臂，是否会发展出汉字->西夏文->汉字字母键盘这样的路线。<br>
其实汉字的部件或部首，就相当于汉字的字母，这不过这种字母比较隐晦庞杂。

我看过几乎所有的输入法专利，包括当时的我自己，发明人几乎都被限制在了为了汉字和编码的映射关系上。<br>
因为从机械键盘到电子键盘，别国文字都能和键盘形成一一映射关系。

但是汉字不能！

这应该就是上面那个课题的结论。因为别国文字都经过转借抽象化。而汉字保留了象形文字太多元素。<br>
从造字方法上看，声旁、形旁这样的符号，就是汉字的字母。但是这些字母，没有进一步被抽象化。

因此，大多数输入法都承袭了林语堂的明快打字机的设计理念，那就是为了不重码，无理化。

相对于形码输入法，拼音输入法则走向了另一套道路，用今天流行语讲叫摆烂。<br>
在简体中文地区更是进一步去掉了声调。

事实上，拼音输入法是最早的汉字输入法，一直是占有率最高的输入法。<br>
只不过，在当时的发明人理念中，只有形码输入法才算输入法。

曾经有个发明人调查，有多少输入法发明人在用自己的输入法。<br>
我说我一直用拼音，这个发明人非常诧异，认为一个输入法如果连发明人自己都不用，凭什么推广给用户。

事实上，我不但一直在用拼音输入法，而且用的是操作系统自带的全拼输入法。最初的版本，只能一个字一个字的输入。
因为，我观察到其他人也是如此。我感觉，大多数人宁愿忍受这种打字方式，而没有去学某种输入法，必然有其深刻原因。

有人知道了我在开发输入法，曾经人们总爱问，你的输入法打字快吗？我回答，很慢。<br>
后来问这种问题的少了，改问，现在不是有什么什么吗，你还搞输入法干什么？<br>
好在，我从来没被这些人干扰了思路。从没试图向他们解释。

## 3.23.1 获取候选列表

输入法调用CDictionarySearch的成员函数FindPhraseForWildcard(&pdret)，将找到的搜索结果保存到候选列表中。<br>
然后从搜索结果的下一位置继续查找，直到文件结束。

```C++
VOID CTableDictionaryEngine::CollectWordForWildcard(_In_ CStringRange *pKeyCode, _Inout_ CSampleImeArray<CCandidateListItem> *pItemList)
{
    CDictionaryResult* pdret = nullptr;
    CDictionarySearch dshSearch(_locale, _pDictionaryFile, pKeyCode);

    while (dshSearch.FindPhraseForWildcard(&pdret))
    {
        for (UINT iIndex = 0; iIndex < pdret->_FindPhraseList.Count(); iIndex++)
        {
            CCandidateListItem* pLI = nullptr;
            pLI = pItemList->Append();
            if (pLI)
            {
                pLI->_ItemString.Set(*pdret->_FindPhraseList.GetAt(iIndex));
                pLI->_FindKeyCode.Set(pdret->_FindKeyCode.Get(), pdret->_FindKeyCode.GetLength());
            }
        }

        delete pdret;
        pdret = nullptr;
    }
}
```